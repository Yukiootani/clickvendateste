<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="config.js"></script>

    <style>
        :root { --primary: #333; --accent: #Cca43b; --bg: #FDFBF7; --text: #333; }
        body { margin:0; font-family:'Montserrat',sans-serif; background:var(--bg); color:var(--text); padding-bottom:100px; }
        
        /* Botão Voltar */
        .back-btn { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.5); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 20; text-decoration: none; color: white; backdrop-filter: blur(5px); }

        /* --- CARROSSEL (SLIDER) --- */
        .slider-container { position: relative; width: 100%; height: 380px; background: #eee; }
        
        .slider { 
            display: flex; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            width: 100%; 
            height: 100%;
            scrollbar-width: none; /* Firefox */
        }
        .slider::-webkit-scrollbar { display: none; /* Chrome */ }
        
        .slide { 
            flex: 0 0 100%; 
            scroll-snap-align: center; 
            height: 100%; 
        }
        .slide img { width: 100%; height: 100%; object-fit: cover; }

        /* Indicadores (Bolinhas) */
        .dots { position: absolute; bottom: 15px; left: 0; width: 100%; display: flex; justify-content: center; gap: 8px; z-index: 10; }
        .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.5); border-radius: 50%; }
        .dot.active { background: white; transform: scale(1.2); }

        /* Vídeo */
        .video-container { padding: 20px; background: black; margin-bottom: 10px; }
        video { width: 100%; border-radius: 10px; }

        /* Conteúdo */
        .content { padding: 25px; background: var(--bg); border-radius: 25px 25px 0 0; margin-top: -20px; position: relative; z-index: 5; }
        .title { font-size: 1.6em; font-weight: 700; color: var(--primary); line-height: 1.2; }
        .price { font-size: 1.8em; color: var(--accent); font-weight: 700; margin: 10px 0; }
        .desc { color: #555; line-height: 1.6; margin-bottom: 20px; white-space: pre-wrap; }

        /* Barra Fixa */
        .action-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; display: flex; gap: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); box-sizing: border-box; z-index: 100; }
        button { flex: 1; padding: 15px; border: none; border-radius: 12px; font-weight: bold; font-size: 1em; cursor: pointer; }
        .btn-add { background: var(--primary); color: white; }
        .btn-zap { background: #25d366; color: white; display: flex; align-items: center; justify-content: center; gap: 8px; }
    </style>
</head>
<body>

    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>

    <div class="slider-container">
        <div class="slider" id="slider-track">
            <div class="slide"><img id="main-img" src=""></div>
        </div>
        <div class="dots" id="slider-dots"></div>
    </div>

    <div class="content">
        <div class="title" id="prod-name">...</div>
        <div class="price" id="prod-price">...</div>
        
        <div id="video-area" style="display:none; margin: 20px -25px;">
            <div class="video-container">
                <h4 style="color:white; margin:0 0 10px 0;"><i class="fas fa-play-circle"></i> Vídeo do Produto</h4>
                <video id="prod-video" controls playsinline></video>
            </div>
        </div>

        <h4 style="margin-bottom:5px; color:#999; font-size:0.9em;">DESCRIÇÃO</h4>
        <div class="desc" id="prod-desc"></div>
    </div>

    <div class="action-bar">
        <button class="btn-add" onclick="addToCart()">ADICIONAR +</button>
        <button class="btn-zap" onclick="buyNow()"><i class="fab fa-whatsapp"></i> COMPRAR</button>
    </div>

    <script>
        if (!firebase.apps.length) firebase.initializeApp(SETUP.firebase);
        const db = firebase.firestore();
        const pid = new URLSearchParams(window.location.search).get('id');
        let productData = null;

        async function load() {
            if(!pid) return location.href='index.html';
            
            const doc = await db.collection('products').doc(pid).get();
            if(!doc.exists) return location.href='index.html';
            
            productData = doc.data();
            productData.id = doc.id;

            // 1. Textos
            document.getElementById('prod-name').innerText = productData.name;
            document.getElementById('prod-price').innerText = '¥ ' + productData.price;
            document.getElementById('prod-desc').innerText = productData.description || "Sem descrição.";

            // 2. Montar Slider (Carrossel)
            const track = document.getElementById('slider-track');
            const dots = document.getElementById('slider-dots');
            track.innerHTML = ''; 
            dots.innerHTML = '';

            // Junta a Capa + Galeria em uma lista única
            let images = [productData.imageUrl]; 
            if(productData.gallery && productData.gallery.length > 0) {
                images = images.concat(productData.gallery);
            }

            // Cria os Slides
            images.forEach((url, index) => {
                // Slide HTML
                track.innerHTML += `<div class="slide"><img src="${url}"></div>`;
                // Bolinha HTML
                dots.innerHTML += `<div class="dot ${index===0?'active':''}"></div>`;
            });

            // Lógica simples das bolinhas ao rolar
            track.addEventListener('scroll', () => {
                const scrollLeft = track.scrollLeft;
                const width = track.offsetWidth;
                const index = Math.round(scrollLeft / width);
                document.querySelectorAll('.dot').forEach((d, i) => {
                    d.classList.toggle('active', i === index);
                });
            });

            // 3. Vídeo
            if(productData.videoUrl) {
                document.getElementById('video-area').style.display = 'block';
                document.getElementById('prod-video').src = productData.videoUrl;
            }
        }

        function addToCart() {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            cart.push(productData);
            localStorage.setItem('cart', JSON.stringify(cart));
            const btn = document.querySelector('.btn-add');
            btn.innerText = "✅ SALVO";
            btn.style.background = "#22c55e";
            setTimeout(() => { if(confirm("Ir para o carrinho?")) location.href='carrinho.html'; }, 300);
        }

        function buyNow() {
            const msg = `Olá! Quero ver o produto: *${productData.name}*`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        document.addEventListener('DOMContentLoaded', load);
    </script>
</body>
</html>
